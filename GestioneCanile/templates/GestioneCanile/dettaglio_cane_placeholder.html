{% extends 'GestioneCanile/base.html' %}

{% block title %}{{ cane_placeholder.nome }} - Gestione Canile{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <img src="https://placedog.net/500/400?id={{ placeholder_id }}" class="img-fluid rounded" alt="{{ cane_placeholder.nome }}" 
             onerror="this.onerror=null; this.src='https://place.dog/500/400?{{ placeholder_id }}'; 
             this.onerror=function(){
                 // Array di razze di cani per diversificare le immagini
                 var breeds = ['retriever-golden', 'retriever-labrador', 'husky', 'beagle', 'boxer', 'bulldog', 'chihuahua', 'collie', 'dachshund', 'dalmatian', 'germanshepherd', 'poodle', 'pug', 'rottweiler', 'terrier'];
                 // Seleziona una razza in base all'ID del cane
                 var breedIndex = {{ placeholder_id }} % breeds.length;
                 var breed = breeds[breedIndex];
                 // Usa immagini di cani da diverse fonti
                 fetch('https://dog.ceo/api/breed/' + breed + '/images/random')
                 .then(response => response.json())
                 .then(data => {
                     if (data.status === 'success') {
                         this.src = data.message;
                     } else {
                         throw new Error('API error');
                     }
                 })
                 .catch(error => {
                     // Se l'API fallisce, usa un'immagine di fallback
                     this.src='https://images.dog.ceo/breeds/' + breed + '/n02099601_{{ placeholder_id|stringformat:'04d' }}.jpg';
                 });
                 // Se l'immagine non può essere caricata, prova un'altra fonte
                 this.onerror=function(){
                     this.src='https://loremflickr.com/500/400/dog?lock={{ placeholder_id }}';
                     this.onerror=function(){
                         this.parentNode.innerHTML='<div class=\'bg-secondary text-white text-center p-5\' style=\'height: 400px;\'><i class=\'fas fa-dog fa-5x\'></i><p class=\'mt-3\'>Nessuna foto disponibile</p></div>';
                     };
                 };
             }">
    </div>
    <div class="col-md-6">
        <h1>{{ cane_placeholder.nome }}</h1>

        <div class="badge bg-success mb-3">Disponibile per adozione</div>

        <table class="table">
            <tr>
                <th>Razza:</th>
                <td>{{ cane_placeholder.razza }}</td>
            </tr>
            <tr>
                <th>Età:</th>
                <td>{{ cane_placeholder.eta }} anni</td>
            </tr>
            <tr>
                <th>Sesso:</th>
                <td>{{ cane_placeholder.sesso }}</td>
            </tr>
            <tr>
                <th>Peso:</th>
                <td>{{ cane_placeholder.peso }} kg</td>
            </tr>
            <tr>
                <th>Taglia:</th>
                <td>{{ cane_placeholder.taglia }}</td>
            </tr>
            <tr>
                <th>Sterilizzato:</th>
                <td>{% if cane_placeholder.sterilizzato %}Sì{% else %}No{% endif %}</td>
            </tr>
            <tr>
                <th>Canile:</th>
                <td>{{ cane_placeholder.canile }}</td>
            </tr>
        </table>

        <a href="{% url 'cani_disponibili_foto' %}" class="btn btn-primary btn-lg mt-3">Torna alla lista</a>
        <a href="{% url 'richiesta_adozione' placeholder_id %}" class="btn btn-success btn-lg mt-3">Richiedi adozione</a>
    </div>
</div>

<div class="row mt-5">
    <div class="col-12">
        <h2>Descrizione</h2>
        <div class="card">
            <div class="card-body">
                <p>{{ cane_placeholder.descrizione|linebreaks }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-12">
        <h2>Caratteristiche</h2>
        <div class="card">
            <div class="card-body">
                <div class="d-flex flex-wrap gap-3">
                    {% if cane_placeholder.compatibile_bambini %}
                    <div class="feature-item">
                        <i class="fas fa-child fa-2x text-success"></i>
                        <p class="mt-2">Compatibile con bambini</p>
                    </div>
                    {% else %}
                    <div class="feature-item">
                        <i class="fas fa-child fa-2x text-danger"></i>
                        <p class="mt-2">Non compatibile con bambini</p>
                    </div>
                    {% endif %}

                    {% if cane_placeholder.compatibile_animali %}
                    <div class="feature-item">
                        <i class="fas fa-paw fa-2x text-success"></i>
                        <p class="mt-2">Compatibile con altri animali</p>
                    </div>
                    {% else %}
                    <div class="feature-item">
                        <i class="fas fa-paw fa-2x text-danger"></i>
                        <p class="mt-2">Non compatibile con altri animali</p>
                    </div>
                    {% endif %}

                    <div class="feature-item">
                        <i class="fas fa-ruler fa-2x text-primary"></i>
                        <p class="mt-2">Taglia {{ cane_placeholder.taglia|lower }}</p>
                    </div>

                    <div class="feature-item">
                        <i class="fas fa-weight fa-2x text-primary"></i>
                        <p class="mt-2">{{ cane_placeholder.peso }} kg</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .feature-item {
        text-align: center;
        padding: 15px;
        border-radius: 5px;
        background-color: #f8f9fa;
        width: 180px;
    }
</style>
{% endblock %}
